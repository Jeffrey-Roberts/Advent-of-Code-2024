package Day06;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

public class Solution {
    public static class Guard {
        int row;
        int column;
        int rotation = 0;
        boolean exited = false;

        public Guard(int row, int column) {
            this.row = row;
            this.column = column;
        }

        public void rotate() {
            this.rotation = (this.rotation + 1) % 4;
        }

    }

    public static int predictGuardsMovement(String input) {
        List<List<String>> map = parseToMap(input);
        Guard guard = findGuard(map);
        assert guard != null;
        return guardMovement(map, guard);
    }

    private static List<List<String>> parseToMap(String input) {
        return Arrays.stream(input.split("\n"))
                .map(row -> Arrays.stream(row.split(""))
                        .collect(Collectors.toCollection(ArrayList::new)))
                .collect(Collectors.toCollection(ArrayList::new));
    }

    private static Guard findGuard(List<List<String>> map) {
        for (int row = 0; row < map.size(); row++) {
            for (int column = 0; column < map.get(row).size(); column++) {
                String elem = map.get(row).get(column);
                if (elem.equals("^")) return new Guard(row, column);
            }
        }
        return null;
    }

    private static int guardMovement(List<List<String>> map, Guard guard) {
        int totalDistinctMovements = 1;
        map.get(guard.row).set(guard.column, "X");

        while (!guard.exited) {
            switch (guard.rotation) {
                case 0:
                    moveUp(map, guard);
                    break;
                case 1:
                    moveRight(map, guard);
                    break;
                case 2:
                    moveDown(map, guard);
                    break;
                case 3:
                    moveLeft(map, guard);
                    break;
            }
            if (!map.get(guard.row).get(guard.column).equals("X")) {
                totalDistinctMovements += 1;
                map.get(guard.row).set(guard.column, "X");
            }
        }

        return totalDistinctMovements;
    }

    private static void moveUp(List<List<String>> map, Guard guard) {
        int row = guard.row;
        int column = guard.column;

        if (row-1 < 0) guard.exited = true;
        else if (map.get(row-1).get(column).equals("#")) guard.rotate();
        else guard.row -= 1;
    }

    private static void moveDown(List<List<String>> map, Guard guard) {
        int row = guard.row;
        int column = guard.column;

        if (row+1 == map.size()) guard.exited = true;
        else if (map.get(row+1).get(column).equals("#")) guard.rotate();
        else guard.row += 1;
    }

    private static void moveLeft(List<List<String>> map, Guard guard) {
        int row = guard.row;
        int column = guard.column;

        if (column-1 < 0) guard.exited = true;
        else if (map.get(row).get(column-1).equals("#")) guard.rotate();
        else guard.column -= 1;
    }

    private static void moveRight(List<List<String>> map, Guard guard) {
        int row = guard.row;
        int column = guard.column;

        if (column+1 == map.get(row).size()) guard.exited = true;
        else if (map.get(row).get(column+1).equals("#")) guard.rotate();
        else guard.column += 1;
    }

    public static void main() {
        String part1Input = """
                ....#.....#......#...............................#...........#.......#.....#................#...#....#....#................#..#.#.
                ...................................................................................#...........#............#.....................
                ..........#..............#.................................................#..............#.......................................
                ....................#...............#...#.....................#..............................#....#.............................#.
                ...............................##...............................................................#............#....................
                ................#...........#................#...............#....#.......#.............................#..........#...........#..
                ...........................#................................................#.##..................#.............#........#........
                ......#......#.....#..........#.......................#..........#.............#.....................#........#....#..............
                ..................................................#..................................#....#.........#...........#..............#..
                ..................................#..................#..........................................#.........#....................#..
                #.................#....................#...........#....................................#......................#..................
                .......#..........................................................................................................#...............
                ...............##.............................#...#.....................#..........................#.......................#......
                ...#.......................................................#..........................................#...................#..#....
                .......#...#.......#.#.............#.....#.##.........................#...........................................................
                #................#.........#.......................##............................................#...#.....#........#.......#.....
                #......##..............................................................#......#....#....#....#.#...............#............#..#..
                .....#...............................##.......................................#.......#......#............................#.....#.
                .........#......#...............................#.....#.....#...................##......#.........................................
                .#.................................................#...............#........#............................#........................
                #.........#.........................................#.......................#..............#......................#...........#...
                ..........................................##.............................................................##..#.......#............
                ...#.........................#...........................................#........#...............................................
                #..................#............#.................................................................#.#....................#....#..#
                ...................#.....................................#.#.........#.............#......#............................##.........
                ....#..............................................................##.......................................................#....#
                .....................#.....#.............................................#.......................#..................#.............
                ...........#.......................................#................#.........#...............#.#...........#.....#.....#........#
                .#..#.................#....#...............................#.................................................##...................
                ..#.....#......#..........#...................#..#..................................................#.......#...#.................
                .............................................................#.......................#..........#.....#...................#.......
                .......#.......................#.#....#...#.....##.......................#.................................................#......
                .................#.....................#...............................................................#..#.......................
                ...#.................#.#..................................................##......................................#..#............
                #........................................................#...#.........#................#.#.......................................
                .................#........#.#........................#.#..................................#.......................................
                ..........#..#......#..................#.........................#................................#...............................
                .............................................................................................#....................................
                .....................#...........#........##.....#.........................#..............................#.....#....#............
                ..#........#.........#.....................................................#......................................................
                ...................................#...................#............#.............#...........................#...................
                ....#.........................................................#................................#......#...#..#....................
                ................................................................................#..#.......#..........................#....#......
                #...........................................................................#........................#............................
                ..#..............#..........#...#..........................................................#......................................
                .......................................................#.................#.#....#.................#..........#....#...............
                ..................................................................................................................................
                .................#.........................................................#..........#.........#.........#.................#.....
                ....................#........#...................#................#...#....................#..............#................#......
                ...#.............##........................................#.........#.................#...........#.........#....................
                ................#............#...........#...............#.....................................#...........................#......
                ....................................................#...........#..............................#..........#...........#...........
                .........#..............#................................#.............#......................................#.........#...#.....
                ..#..#.........................................#.............................#....................................................
                .#............................##...#..........#............#..#.........................#......................#...#..............
                ........#.....#..............#..................................................#...#......................#....#..............#..
                ...............................................#.........#..................#............#.............................#..........
                ..................................................................................................#....#..........................
                ..............#..............................................................#....................................................
                .....#....#.....................#......................#...........#...#..#.............#.......................#.................
                .............................#...#..#...........................#............................................................#....
                .............................................#...............................#...................................................#
                ..................................................................#......#....#.......................#.......#........#..........
                ..................#.#.........................................................................................##.......#........#.
                .............................#.......................#.......................................##...................................
                .....#.............................................................................................................#.#............
                ...............##.........#..#.....#...............#....................#.................................#.#....#................
                ................#......................................................................#...............#...................#......
                .................#..............#.................................................................................................
                ............#...#...........................................................................................#......#..............
                ..#.....................................................................#.....#.#.#......#....#..........#........................
                .#........#.............................#.....................#.....................#....#........................................
                .......................................................................................................#..........................
                ...#........#..................................................#.........................................................#......#.
                .......#.......#..#.................................................................................................#.............
                ..............................#..#..........................#..#..................#.............#.................................
                ..................#...#.............................................#...................#.......#...............#.................
                ...#.......#........#.....................................#...........#.................................................#.........
                .#.............#....................................#........................................................##............#...#..
                ...............#.....#....................................................................................#....#................#.
                ....#...........................................................#.....#..............................................#............
                .........#..........#...........................#.......................................#....#....................#...............
                ...............................................................#..........#......^...............................................#
                #..........................#.....................#..............................#..............................#..................
                ...................#.....#......#...........#........#............#.......#.......#...............................................
                .....#.....#.............................................................#..............#........#..........................#....#
                ............#...............................................................#.............#......................#................
                .....#...............................................##........................................#.......#......#...................
                .........................................#........................................................................................
                ..........................#...............................#............#............................#.....#.......................
                ...##.........#......#.....#...............................................................#........#.............................
                ......#...............#.#......................#.......#..............................#...#.........#.........#..#.........#......
                ....#......#....#........#.#.............................#......................................................#.....#...........
                .....#.............#.....................#...#...............#....................................................................
                ......#............#............#.#............#....................#.............................................................
                .............#..................................................#....................#.............#.......#.............#........
                .............................................#......................................................................#.............
                ...............................#............................................................#................#...................#
                ............#.....#....................................................................................................#.#........
                .........................#....................#...##.......#............#..#.................................#......#.............
                ....#......................#.....................#...........#.........................................#......#.#.................
                ..................................................................#..........................#......................#.............
                .......................#......#..............................................................................#....................
                .......#.................#...............................##...............................................#.............#.........
                .#..............#.....................................................................................................#...........
                .......##.................#................#.#...#......................................#...............#...#.....................
                .............##......................................................#....................................#..........#............
                ....................................#............#............#............#.....................................#................
                ................#..#............................#..............................................#.....#...................#......#.
                ....................#....#......#..................#................#.............................................................
                ...............##...............#...#..........................#......#...............#..#................#.....#.............#...
                ...........#..........#..........#..#.........#....#...#......#..............#................#....#..#...........................
                #.....................#..#...................................#...#..............................#......#.#.#......................
                ............##...................#..#.............................................................................................
                ..............................................#.#.......................#.................#....#..................#.......#.......
                ....#................#......#........................................................#........#..............#....................
                .........#.#...............#............................###...........#...........................................................
                .........#.................................................................................#......#...#..............#......#.....
                ....#....#......#.#.........#..........#...............#.........#............##.............#..#............................#....
                ....#..#...#.....#...........................#.#.......................................#...#.....................#............#..#
                ...........#............................#........#...#......#...............................................#...#.................
                ..#...............................................................#..............................................#.........#......
                ...................#.....................................#....................................#.#.#............#............#.....
                .....#.................#...........................##.................#..#........................................................
                ...#.......#...................................#.............................#...........#......##.#...#.........#.#...........#..
                .#.............#......#..#...#......................................................#..............#.............#.#..............
                .......................#............#...................#.....................#.......................#.............#..#......#...
                ......................#..#.#.......#........#....#.............#.........#..............................#.#..........#........#...
                .................#.............#..#..........#...#.........#..................................#..#.............#................#.
                .#..................................#....#...........................................#..............................#...#.........
                """;
        System.out.println(predictGuardsMovement(part1Input));
    }
}
